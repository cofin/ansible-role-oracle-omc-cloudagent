---
# tasks file for oracle-omc-cloudagent
- name: Set facts about installation
  include_tasks: facts.yml
  tags:
    - oem

- name: "download latest cloud agent from public URL"
  get_url:
    url: "{{ oem_software_url }}"
    dest: "{{ role_path }}/files/cloudagent_linux.x64.zip"
  delegate_to: localhost
  become: false

- name: Validate files exist locally
  local_action: stat path="{{ role_path }}/files/cloudagent_linux.x64.zip"
  become: false
  register: ls_omc_cloudagent_image

- include: "{{ role_path }}/tasks/os.yml"

- name: create destination directory
  file:
    dest: "{{ item }}"
    state: directory
    owner: "{{ omc_cloudagent_users.0.username }}"
    group: "{{ omc_cloudagent_users.0.group }}"
  with_items:
    - "{{ omc_cloudagent_stage_dir }}"
    - "{{ omc_cloudagent_install_dir }}"
  become_user: root

- name: uploading and unarchive installer
  unarchive:
    src: "{{ role_path }}/files/cloudagent_linux.x64.zip"
    dest: "{{ omc_cloudagent_stage_dir }}"
  tags: install
