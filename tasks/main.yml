---
# tasks file for oracle-omc-cloudagent
- name: Set facts about installation
  include_tasks: facts.yml
- name: create source directory for files
  file:
    dest: "{{ item }}"
    state: directory
  with_items:
    - "{{ role_path }}/files"
  delegate_to: localhost
  become: no

- name: check to see if we already have files downloaded
  local_action: stat path="{{ role_path }}/files/cloudagent_linux.x64.zip"
  become: no
  #delegate_to: localhost
  register: ls_omc_cloudagent_image
- name: "download latest cloud agent from public URL"
  get_url:
    url: "{{ omc_cloudagent_software_url }}"
    dest: "{{ role_path }}/files/cloudagent_linux.x64.zip"
  delegate_to: localhost
  become: no

- include: "{{ role_path }}/tasks/os.yml"

- name: create destination directory
  file:
    dest: "{{ item }}"
    state: directory
    owner: "{{ omc_cloudagent_users.0.username }}"
    group: "{{ omc_cloudagent_users.0.group }}"
  with_items:
    - "{{ omc_cloudagent_stage_dir }}"
    - "{{ omc_cloudagent_install_dir }}"
  become: yes
  become_user: root

- name: uploading and unarchive installer
  unarchive:
    src: "{{ role_path }}/files/cloudagent_linux.x64.zip"
    dest: "{{ omc_cloudagent_stage_dir }}"
  tags: install
